<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Travel Planner - Plan a Trip</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@400;700&display=swap');
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(to bottom, #a8e6ff, #f0faff);
  display: flex;
  height: 100vh;
  overflow-y: scroll;
  scrollbar-width: none;
}
body::-webkit-scrollbar { display: none; }
</style>
</head>
<body>

<!-- Floating icons -->
<img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" class="floating" alt="plane">
<img src="https://cdn-icons-png.flaticon.com/512/414/414927.png" class="floating" alt="cloud">
<img src="https://cdn-icons-png.flaticon.com/512/616/616490.png" class="floating" alt="luggage">
<img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" class="floating" alt="plane">
<img src="https://cdn-icons-png.flaticon.com/512/414/414927.png" class="floating" alt="cloud">

<!-- Sidebar -->
<div class="sidebar">
  <div>
    <h1>Smart Travel Planner</h1>
    <div class="menu">
      <button id="exploreBtn">üè† Explore</button>
      <button id="planTripBtn" class="active">üß≠ Plan a Trip</button>
      <button id="myTripsBtn">üß≥ My Trips</button>
      <button id="profileBtn">üë§ Profile</button>
    </div>
  </div>
  <div class="menu">
    <button id="logoutBtn">üö™ Logout</button>
  </div>
</div>

<!-- Main content -->
<div class="main-content">
  <div class="plan-trip">
    <h2>Plan Your Trip</h2>
    <form id="tripForm">
      <input id="origin" placeholder="Your Starting City" required>
      <input id="destination" placeholder="Destination City" required>
      <input type="date" id="date" required>
      <input type="number" id="days" placeholder="Number of Days" min="1" required>
      <input type="number" id="travelers" placeholder="Number of Travelers" min="1" required>
      <input type="number" id="budget" placeholder="Budget (INR)" min="1" required>
      <button type="submit">Plan Trip</button>
    </form>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay"><div class="loader"></div></div>

<!-- AI Assistant -->
<button class="assistant-btn" id="assistantBtn" title="Chat with AI">ü§ñ</button>
<div class="chat-box" id="chatBox">
  <div class="chat-header">AI Assistant</div>
  <div class="chat-body" id="chatBody">
    <p>üëã Need help planning your trip? Ask me anything!</p>
  </div>
  <div class="chat-input">
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="sendBtn"><span>üì§</span></button>
  </div>
</div>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // üî• Firebase configuration (fixed storageBucket)
  const firebaseConfig = {
    apiKey: "AIzaSyAw-AhqKS1FemISwb7JdyldSb_ESp1FQhA",
    authDomain: "smart-travel-planner-bd849.firebaseapp.com",
    projectId: "smart-travel-planner-bd849",
    storageBucket: "smart-travel-planner-bd849.appspot.com",
    messagingSenderId: "1017075766889",
    appId: "1:1017075766889:web:6c7c7d3440c3aac45db4f8"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;

  // üßç‚Äç‚ôÇÔ∏è Detect current user
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      console.log("Logged in as:", user.email);
    } else {
      window.location.href = "index.html";
    }
  });

  // üåç Trip Form Handling
  const form = document.getElementById("tripForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const overlay = document.getElementById("loadingOverlay");
    overlay.style.display = "flex";

    const origin = document.getElementById("origin").value;
    const destination = document.getElementById("destination").value;
    const date = document.getElementById("date").value;
    const days = document.getElementById("days").value;
    const travelers = document.getElementById("travelers").value;
    const budget = document.getElementById("budget").value;

    try {
      if (!currentUser) throw new Error("User not logged in.");

      await addDoc(collection(db, "users", currentUser.uid, "trips"), {
        origin,
        destination,
        date,
        days,
        travelers,
        budget,
        createdAt: new Date().toISOString()
      });

      alert("‚úÖ Trip saved successfully!");
      window.location.href = "mytrips.html";
    } catch (err) {
      alert("Error saving trip: " + err.message);
      console.error(err);
    } finally {
      overlay.style.display = "none";
    }
  });
</script>

<!-- Chatbot + Google Maps -->
<script>
const assistantBtn = document.getElementById('assistantBtn');
const chatBox = document.getElementById('chatBox');
assistantBtn.addEventListener('click', () => chatBox.classList.toggle('active'));

const chatBody = document.getElementById('chatBody');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

async function sendMessage() {
  const msg = userInput.value.trim();
  if (!msg) return;
  chatBody.innerHTML += `<p><strong>You:</strong> ${msg}</p>`;
  userInput.value = '';
  chatBody.scrollTop = chatBody.scrollHeight;

  try {
    const res = await fetch('https://smart-travel-planner-68vq.onrender.com/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    chatBody.innerHTML += `<p><strong>AI:</strong> ${data.reply}</p>`;
  } catch {
    chatBody.innerHTML += `<p><strong>AI:</strong> Sorry, I‚Äôm having trouble connecting.</p>`;
  }
  chatBody.scrollTop = chatBody.scrollHeight;
}

sendBtn.onclick = sendMessage;
userInput.addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });

document.getElementById('exploreBtn').onclick = () => window.location.href = 'home.html';
document.getElementById('myTripsBtn').onclick = () => window.location.href = 'mytrips.html';
document.getElementById('profileBtn').onclick = () => window.location.href = 'profile.html';
document.getElementById('logoutBtn').onclick = () => window.location.href = 'index.html';
</script>

<script>
function initAutocomplete() {
  const originInput = document.getElementById('origin');
  new google.maps.places.Autocomplete(originInput, { types: ['(cities)'] });
  const destInput = document.getElementById('destination');
  new google.maps.places.Autocomplete(destInput, { types: ['(cities)'] });
}
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgnTn2jnHUN8bTJkFkDm05ginAbAG9urU&libraries=places&callback=initAutocomplete"></script>
</body>
</html>
